<!DOCTYPE html>
<!-- the "source code" of this is at prompts/test/clock.html.txt -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24-Hour Dusks and Dawns Clock</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .clock-container {
            margin-bottom: 30px;
        }
        .clock {
            border: 2px solid #333;
            border-radius: 50%;
            background: radial-gradient(circle, #2a2a2a 60%, #3a3a3a 100%);
        }
        .time-table {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .time-table h3 {
            margin-top: 0;
            color: #ffa500;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #333;
        }
        th {
            background: #333;
            color: #ffa500;
        }
        .loading {
            color: #888;
            font-style: italic;
        }
        .error {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <h1>24-Hour Dusks and Dawns Clock</h1>
    <div class="clock-container">
        <svg class="clock" width="400" height="400" viewBox="-20 -20 440 440">
            <!-- Clock background circle -->
            <circle cx="200" cy="200" r="190" fill="none" stroke="#333" stroke-width="2" />
            
            <!-- Hour markers -->
            <g id="hour-markers"></g>
            
            <!-- Dawn/dusk sections -->
            <g id="dawn-dusk-sections"></g>
            
            <!-- Current time arm -->
            <line id="time-arm" x1="200" y1="200" x2="200" y2="50" stroke="#ff6b6b" stroke-width="3" stroke-linecap="round" />
            
            <!-- Hour labels (moved to end to prevent clipping) -->
            <g id="hour-labels"></g>
            
            <!-- Center dot -->
            <circle cx="200" cy="200" r="6" fill="#ff6b6b" />
        </svg>
    </div>

    <div class="time-table">
        <h3>Daily Light Transitions</h3>
        <div id="status" class="loading">Getting location...</div>
        <div id="location-info" style="display: none; margin-bottom: 15px; font-size: 14px; color: #aaa;"></div>
        <table id="transitions-table" style="display: none;">
            <thead>
                <tr>
                    <th>Transition</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody id="transitions-body">
            </tbody>
        </table>
    </div>

    <script src="../dist/daylight.umd.js"></script>
    <script>
            class DusksAndDawnsClock {
                constructor() {
                    this.latitude = null;
                    this.longitude = null;
                    this.transitions = null;
                    this.init();
                }

            init() {
                this.createHourMarkers();
                this.getCurrentLocation();
                setInterval(() => this.updateClock(), 60000); // Update every minute
            }

            createHourMarkers() {
                const markersGroup = document.getElementById('hour-markers');
                const labelsGroup = document.getElementById('hour-labels');

                for (let hour = 0; hour < 24; hour++) {
                    // Calculate angle for 24-hour clock (0° = noon, 90° = 6pm, 180° = midnight, 270° = 6am)
                    const angle = ((hour - 12) * 15) * Math.PI / 180; // -12 to make noon straight up

                    // Outer point for hour marker
                    const outerX = 200 + 180 * Math.sin(angle);
                    const outerY = 200 - 180 * Math.cos(angle); // Negative because SVG Y increases downward

                    // Inner point for hour marker
                    const innerX = 200 + 160 * Math.sin(angle);
                    const innerY = 200 - 160 * Math.cos(angle);

                    // Create hour marker line
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', innerX);
                    line.setAttribute('y1', innerY);
                    line.setAttribute('x2', outerX);
                    line.setAttribute('y2', outerY);
                    line.setAttribute('stroke', hour % 6 === 0 ? '#666' : '#444');
                    line.setAttribute('stroke-width', hour % 6 === 0 ? '2' : '1');
                    markersGroup.appendChild(line);

                    // Add hour labels for all hours (to separate group)
                    const labelX = 200 + 205 * Math.sin(angle);
                    const labelY = 200 - 205 * Math.cos(angle);

                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', labelX);
                    text.setAttribute('y', labelY);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('dominant-baseline', 'central');
                    text.setAttribute('fill', hour % 6 === 0 ? '#aaa' : '#777');
                    text.setAttribute('font-size', hour % 6 === 0 ? '12' : '10');
                    text.setAttribute('font-weight', hour % 6 === 0 ? 'bold' : 'normal');

                    // Convert to 12-hour format with AM/PM
                    let displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                    let ampm = hour < 12 ? 'AM' : 'PM';
                    text.textContent = `${displayHour}${ampm}`;

                    labelsGroup.appendChild(text);
                }
            }

            getCurrentLocation() {
                if ('geolocation' in navigator) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            this.latitude = position.coords.latitude;
                            this.longitude = position.coords.longitude;
                            document.getElementById('status').style.display = 'none';
                            document.getElementById('location-info').innerHTML =
                                `<strong>Location:</strong> ${this.latitude.toFixed(4)}°N, ${Math.abs(this.longitude).toFixed(4)}°${this.longitude >= 0 ? 'E' : 'W'}`;
                            document.getElementById('location-info').style.display = 'block';
                            this.calculateTransitions();
                            this.updateClock();
                        },
                        (error) => {
                            this.latitude = 40.7;
                            this.longitude = -74.0;
                            document.getElementById('status').innerHTML =
                                '<span class="error">Location access denied. Using default location.</span>';
                            document.getElementById('location-info').innerHTML =
                                `<strong>Location:</strong> ${this.latitude.toFixed(4)}°N, ${Math.abs(this.longitude).toFixed(4)}°W <em>(default)</em>`;
                            document.getElementById('location-info').style.display = 'block';
                            this.calculateTransitions();
                            this.updateClock();
                        }
                    );
                } else {
                    this.latitude = 40.7;
                    this.longitude = -74.0;
                    document.getElementById('status').innerHTML =
                        '<span class="error">Geolocation not supported. Using default location.</span>';
                    document.getElementById('location-info').innerHTML =
                        `<strong>Location:</strong> ${this.latitude.toFixed(4)}°N, ${Math.abs(this.longitude).toFixed(4)}°W <em>(default)</em>`;
                    document.getElementById('location-info').style.display = 'block';
                    this.calculateTransitions();
                    this.updateClock();
                }
            }

            calculateTransitions() {
                if (!this.latitude || !this.longitude) return;

                const today = new Date();
                this.transitions = daylight(today, this.latitude, this.longitude);

                this.updateTransitionsTable();
                this.drawDawnDuskSections();
            }

            updateTransitionsTable() {
                const table = document.getElementById('transitions-table');
                const tbody = document.getElementById('transitions-body');
            
                tbody.innerHTML = '';
                
                const transitionOrder = [
                    ['Astronomical Dawn', 'astronomicalDawn', '#001a33'],
                    ['Nautical Dawn', 'nauticalDawn', '#003366'],
                    ['Civil Dawn', 'civilDawn', '#004d99'],
                    ['Sunrise', 'sunrise', '#ffa500'],
                    ['Sunset', 'sunset', '#ff6b00'],
                    ['Civil Dusk', 'civilDusk', '#004d99'],
                    ['Nautical Dusk', 'nauticalDusk', '#003366'],
                    ['Astronomical Dusk', 'astronomicalDusk', '#001a33']
                ];

                transitionOrder.forEach(([name, key, color]) => {
                    const time = this.transitions[key];
                    const row = tbody.insertRow();
                
                    const nameCell = row.insertCell();
                    nameCell.innerHTML = `<span style="color: ${color}; font-weight: bold;">●</span> ${name}`;
                    
                    const timeCell = row.insertCell();
                    timeCell.textContent = time.toLocaleTimeString();
                });

                table.style.display = 'table';
            }

            drawDawnDuskSections() {
                const sectionsGroup = document.getElementById('dawn-dusk-sections');
                sectionsGroup.innerHTML = '';
                
                const sections = [
                    {
                        start: this.transitions.astronomicalDawn,
                        end: this.transitions.nauticalDawn,
                        color: 'rgba(30, 60, 120, 1)',
                        name: 'astronomical-dawn'
                    },
                    {
                        start: this.transitions.nauticalDawn,
                        end: this.transitions.civilDawn,
                        color: 'rgba(60, 120, 200, 1)',
                        name: 'nautical-dawn'
                    },
                    {
                        start: this.transitions.civilDawn,
                        end: this.transitions.sunrise,
                        color: 'rgba(120, 180, 255, 1)',
                        name: 'civil-dawn'
                    },
                    {
                        start: this.transitions.sunrise,
                        end: this.transitions.sunset,
                        color: 'rgba(255, 200, 50, 1)',
                        name: 'daylight'
                    },
                    {
                        start: this.transitions.sunset,
                        end: this.transitions.civilDusk,
                        color: 'rgba(255, 140, 80, 1)',
                        name: 'civil-dusk'
                    },
                    {
                        start: this.transitions.civilDusk,
                        end: this.transitions.nauticalDusk,
                        color: 'rgba(200, 80, 120, 1)',
                        name: 'nautical-dusk'
                    },
                    {
                        start: this.transitions.nauticalDusk,
                        end: this.transitions.astronomicalDusk,
                        color: 'rgba(120, 40, 80, 1)',
                        name: 'astronomical-dusk'
                    },
                    // Night section split into two parts to handle day boundary
                    {
                        start: this.transitions.astronomicalDusk,
                        end: new Date(this.transitions.astronomicalDusk.getFullYear(), this.transitions.astronomicalDusk.getMonth(), this.transitions.astronomicalDusk.getDate() + 1, 0, 0, 0),
                        color: 'rgba(0, 0, 0, 1)',
                        name: 'night-evening'
                    },
                    {
                        start: new Date(this.transitions.astronomicalDawn.getFullYear(), this.transitions.astronomicalDawn.getMonth(), this.transitions.astronomicalDawn.getDate(), 0, 0, 0),
                        end: this.transitions.astronomicalDawn,
                        color: 'rgba(0, 0, 0, 1)',
                        name: 'night-morning'
                    }
                ];

                sections.forEach(section => {
                    // Only draw sections with valid time ranges
                    if (section.start.getTime() !== section.end.getTime()) {
                        this.drawTimeSection(sectionsGroup, section.start, section.end, section.color);
                    }
                });
            }

            drawTimeSection(parent, startTime, endTime, color) {
                const startHours = startTime.getHours() + startTime.getMinutes() / 60;
                const endHours = endTime.getHours() + endTime.getMinutes() / 60;
                
                // Convert to 24-hour clock angles (noon = 0°)
                const startAngle = ((startHours - 12) * 15) * Math.PI / 180;
                const endAngle = ((endHours - 12) * 15) * Math.PI / 180;
                
                const centerX = 200;
                const centerY = 200;
                const radius = 150;
                
                // Calculate arc path
                const startX = centerX + radius * Math.sin(startAngle);
                const startY = centerY - radius * Math.cos(startAngle);
                const endX = centerX + radius * Math.sin(endAngle);
                const endY = centerY - radius * Math.cos(endAngle);
                
                // Calculate proper arc direction - always go clockwise from start to end
                let angleDiff = endHours - startHours;
                if (angleDiff <= 0) angleDiff += 24; // Handle day boundary crossing
                const largeArc = angleDiff > 12 ? 1 : 0;
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const pathData = [
                    `M ${centerX} ${centerY}`,
                    `L ${startX} ${startY}`,
                    `A ${radius} ${radius} 0 ${largeArc} 1 ${endX} ${endY}`,
                    'Z'
                ].join(' ');
                
                path.setAttribute('d', pathData);
                path.setAttribute('fill', color);
                path.setAttribute('stroke', 'none');
                
                parent.appendChild(path);
            }

            updateClock() {
                const now = new Date();
                const hours = now.getHours() + now.getMinutes() / 60;

                // Calculate angle for current time (noon = 0°)
                const angle = ((hours - 12) * 15) * Math.PI / 180;

                // Calculate arm end position
                const armLength = 140;
                const endX = 200 + armLength * Math.sin(angle);
                const endY = 200 - armLength * Math.cos(angle); // Negative because SVG Y increases downward
            
                const timeArm = document.getElementById('time-arm');
                timeArm.setAttribute('x2', endX);
                timeArm.setAttribute('y2', endY);
            }
        }

            // Initialize the clock when page loads
            window.addEventListener('load', () => {
                new DusksAndDawnsClock();
            });
    </script>
</body>
</html>